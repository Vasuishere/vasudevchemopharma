{% load static storage_extras %}
<nav class="navbar-container" role="navigation" aria-label="Main navigation">
    <a href="/" class="logo">
        {% if company.company_logo and company.company_logo.name|file_exists %}
            <img src="{{ company.company_logo.url }}" alt="{{ company.company_name }} Logo" class="logo-img">
        {% else %}
            <img src="{% static 'media/logo.png' %}" alt="Logo" class="logo-img">
        {% endif %}
        {% if company.company_name_image %}
            <img src="{{ company.company_name_image.url }}" alt="{{ company.company_name }}" class="logo-name-img">
        {% else %}
            <span class="logo-text">{{ company.company_name }}</span>
        {% endif %}
    </a>
    <button class="menu-toggle" id="menuToggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="navLinks">
        <span>&#9776;</span>
    </button>
    <ul class="nav-links" id="navLinks">
        <li><a href="/">Home</a></li>
        <li><a href="{% url 'aboutus' %}">About</a></li>
        <li><a href="{% url 'products' %}">Products</a></li>
        <li><a href="{% url 'ourservices' %}">Our Services</a></li>
        <li><a href="#contact">Contact</a></li>
        <li>
            <div class="dropdown">
                <button class="btn dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Select Your Language
                </button>
                <ul class="dropdown-menu language-menu" aria-labelledby="languageDropdown" id="languageMenu"></ul>
            </div>
        </li>
    </ul>
</nav>

<!-- Hidden Google Translate container -->
<div id="google_translate_element" style="display:none;"></div>

<script>
    // Mobile Navigation Toggle
    document.addEventListener('DOMContentLoaded', function () {
        var menuToggle = document.getElementById('menuToggle');
        var navLinks = document.getElementById('navLinks');

        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();
                navLinks.classList.toggle('active');
                var icon = menuToggle.querySelector('span');
                if (navLinks.classList.contains('active')) {
                    icon.innerHTML = '&#10005;';
                    menuToggle.setAttribute('aria-expanded', 'true');
                } else {
                    icon.innerHTML = '&#9776;';
                    menuToggle.setAttribute('aria-expanded', 'false');
                }
            });

            // Close mobile menu when clicking on a link
            navLinks.querySelectorAll('a').forEach(function (link) {
                link.addEventListener('click', function () {
                    if (window.innerWidth < 992) {
                        navLinks.classList.remove('active');
                        menuToggle.querySelector('span').innerHTML = '&#9776;';
                        menuToggle.setAttribute('aria-expanded', 'false');
                    }
                });
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', function (e) {
                if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                    navLinks.classList.remove('active');
                    menuToggle.querySelector('span').innerHTML = '&#9776;';
                    menuToggle.setAttribute('aria-expanded', 'false');
                }
            });

            // Handle window resize â€“ close mobile menu on desktop
            window.addEventListener('resize', function () {
                if (window.innerWidth >= 992) {
                    navLinks.classList.remove('active');
                    menuToggle.querySelector('span').innerHTML = '&#9776;';
                    menuToggle.setAttribute('aria-expanded', 'false');
                }
            });
        }
    });

    // Google Translate integration
    function googleTranslateElementInit() {
        if (window.google && window.google.translate) {
            new window.google.translate.TranslateElement({
                pageLanguage: 'en',
                autoDisplay: false
            }, 'google_translate_element');
        }
    }

    function setLanguage(langCode, attempt) {
        attempt = attempt || 0;
        var select = document.querySelector('.goog-te-combo');
        if (select) {
            if (select.value === langCode) return;
            select.value = langCode;
            var event;
            try { event = new Event('change'); }
            catch (e) { event = document.createEvent('HTMLEvents'); event.initEvent('change', true, true); }
            select.dispatchEvent(event);
        } else if (attempt < 20) {
            setTimeout(function () { setLanguage(langCode, attempt + 1); }, 150);
        }
    }

    function populateLanguageMenu(attempt) {
        attempt = attempt || 0;
        var menu = document.getElementById('languageMenu');
        if (!menu) return;
        var select = document.querySelector('.goog-te-combo');
        if (!select || !select.options || select.options.length === 0) {
            if (attempt < 20) setTimeout(function () { populateLanguageMenu(attempt + 1); }, 150);
            return;
        }
        menu.innerHTML = '';
        Array.prototype.forEach.call(select.options, function (opt) {
            var code = opt.value;
            var name = opt.textContent || opt.innerText;
            if (!code) return;
            if (code === 'hi' || code === 'gu') return;
            var li = document.createElement('li');
            var a = document.createElement('a');
            a.className = 'dropdown-item lang-select';
            a.href = '#';
            a.setAttribute('data-lang', code);
            a.textContent = name;
            li.appendChild(a);
            menu.appendChild(li);
        });
    }

    document.addEventListener('click', function (e) {
        var link = e.target.closest('.lang-select');
        if (!link) return;
        e.preventDefault();
        setLanguage(link.getAttribute('data-lang'));
    });

    window.addEventListener('load', function () {
        populateLanguageMenu();
        setTimeout(populateLanguageMenu, 500);
        setTimeout(populateLanguageMenu, 1500);
    });
</script>

<!-- Load Google Translate script -->
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
